<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Tiktok Control Room</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <iframe id="dashboard-iframe" src="https://tiktok-play.gatradigital.com/control-room"></iframe>
    
    <!-- Script untuk menangani postMessage dari iframe -->
    <script>
        // Handler untuk parent window di Cordova
        (function() {
            'use strict';
            
            // Tunggu sampai Cordova siap
            document.addEventListener('deviceready', function() {
                console.log('üì± Cordova ready, setting up iframe message handler');
                setupIframeMessageHandler();
            }, false);
            
            // Jika deviceready sudah terjadi atau tidak di Cordova, setup langsung
            if (document.readyState === 'complete' || document.readyState === 'interactive') {
                setupIframeMessageHandler();
            } else {
                document.addEventListener('DOMContentLoaded', setupIframeMessageHandler);
            }
            
            function setupIframeMessageHandler() {
                // Listen untuk postMessage dari iframe
                window.addEventListener('message', function(event) {
                    // Untuk keamanan, bisa validasi origin di sini
                    // if (event.origin !== 'https://tiktok-play.gatradigital.com') return;
                    
                    if (event.data && event.data.type === 'openInAppBrowser') {
                        const url = event.data.url;
                        console.log('üì® Received message to open InAppBrowser:', url);
                        
                        if (url) {
                            openInAppBrowser(url);
                        }
                    }
                }, false);
                
                console.log('‚úÖ Iframe message handler setup');
            }
            
            function openInAppBrowser(url) {
                try {
                    // Deteksi Cordova
                    if (window.cordova || window.PhoneGap) {
                        console.log('üì± Opening with Cordova InAppBrowser');
                        
                        // Cara 1: Gunakan window.open (akan otomatis menggunakan InAppBrowser jika plugin terpasang)
                        const ref = window.open(url, '_blank', 'location=yes,zoom=no,toolbar=yes');
                        
                        if (ref) {
                            console.log('‚úÖ InAppBrowser opened');
                            return;
                        }
                        
                        // Cara 2: Gunakan cordova.InAppBrowser langsung jika tersedia
                        if (window.cordova && window.cordova.InAppBrowser) {
                            window.cordova.InAppBrowser.open(url, '_blank', 'location=yes,zoom=no,toolbar=yes');
                            console.log('‚úÖ InAppBrowser opened via cordova.InAppBrowser');
                            return;
                        }
                    }
                    
                    // Fallback ke browser normal
                    console.log('üåê Opening with default browser');
                    window.open(url, '_blank');
                } catch (error) {
                    console.error('‚ùå Error opening InAppBrowser:', error);
                    // Fallback
                    window.open(url, '_blank');
                }
            }
        })();
    </script>
    
    <!-- Script Cordova harus di-load terakhir -->
    <script src="cordova.js"></script>
</body>
</html>

